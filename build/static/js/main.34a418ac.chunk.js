(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{29:function(e,t,a){e.exports=a(57)},34:function(e,t,a){},57:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(13),i=a.n(o),l=(a(34),a(3)),u=a(4),c=a(7),s=a(5),h=a(6),d=a(25),p=a.n(d),m=a(2),f=a.n(m),g=a(8),b=a(9);function v(){var e=Object(g.a)(["\n  font-family: inherit;\n  font-size: 1rem;\n  border-radius: 0;\n  padding: 0.25rem 1rem;\n  margin: 0 1rem;\n  margin-bottom: 0.3rem;\n  background: #777;\n  color: white;\n  border: 2px solid;\n"]);return v=function(){return e},e}function k(){var e=Object(g.a)(["\n  font-family: inherit;\n  font-size: 1rem;\n  border-radius: 0;\n  padding: 0.25rem 1rem;\n  margin: 0 1rem;\n  background: transparent;\n  color: white\n  border: 2px solid;\n"]);return k=function(){return e},e}function E(){var e=Object(g.a)(["\n  color: white;\n"]);return E=function(){return e},e}function j(){var e=Object(g.a)(["\n  font-size: 1.3em;\n"]);return j=function(){return e},e}function O(){var e=Object(g.a)(["\n  background-color: #555;\n"]);return O=function(){return e},e}function y(){var e=Object(g.a)(["\n  padding: 30px;\n  background-color: #333;\n"]);return y=function(){return e},e}function V(){var e=Object(g.a)(["\n  background-color: #222;\n"]);return V=function(){return e},e}function w(){var e=Object(g.a)(["\n  padding: 20px;\n  color: white;\n"]);return w=function(){return e},e}function I(){var e=Object(g.a)(["\n  text-align: center;\n"]);return I=function(){return e},e}var C=b.a.div(I()),S=b.a.div(w()),A=Object(b.a)(S)(V()),B=Object(b.a)(S)(y()),D=Object(b.a)(S)(O()),x=b.a.h1(j()),F=b.a.p(E()),U=b.a.button(k()),L=b.a.input(v()),P={signInFlow:"popup",signInOptions:[f.a.auth.GoogleAuthProvider.PROVIDER_ID,f.a.auth.FacebookAuthProvider.PROVIDER_ID,f.a.auth.EmailAuthProvider.PROVIDER_ID],callbacks:{signInSuccessWithAuthResult:function(){return!1}}},R=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement(C,null,r.a.createElement(A,null,r.a.createElement(x,null,"Library test app for Expedition project"),r.a.createElement(F,null,"Please Log-in:"),r.a.createElement(p.a,{uiConfig:P,firebaseAuth:f.a.auth()})))}}]),t}(n.Component),z=a(19),T=a(14),M=a(12),W=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(s.a)(t).call(this,e))).onClickSetFav=function(){var e=a.state.fav,t=f.a.firestore().collection("Authors").doc(a.props.books.authorid).collection("Books").doc(a.props.books.id);a.state.fav?t.update({favedBy:f.a.firestore.FieldValue.arrayRemove(f.a.auth().currentUser.uid)}).then(function(){return console.log("Book unfaved")}):t.update({favedBy:f.a.firestore.FieldValue.arrayUnion(f.a.auth().currentUser.uid)}).then(function(){return console.log("Book faved")}),e=!e,a.setState({fav:e})},a.state={fav:!1},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.state.fav;this.props.books.favedBy.includes(f.a.auth().currentUser.uid)&&(e=!e,this.setState({fav:e}))}},{key:"render",value:function(){var e=this.props.books;return r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("img",{src:e.coverUrl,alt:e.title+" cover",height:"400",width:"300"})),r.a.createElement("td",null,e.title),r.a.createElement("td",null,e.author),r.a.createElement("td",null,r.a.createElement("button",{onClick:this.onClickSetFav},this.state.fav?r.a.createElement("i",{className:"fas fa-heart"}):r.a.createElement("i",{className:"far fa-heart"})))))}}]),t}(n.Component),G=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.books;return r.a.createElement("div",null,r.a.createElement("p",null,"List of known books:"),r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Cover"),r.a.createElement("th",null,"Title"),r.a.createElement("th",null,"Author"),r.a.createElement("th",null,"Favorite")),e.map(function(e){return r.a.createElement(W,{key:e.id,books:e})}))))}}]),t}(n.Component),N=function(e){var t=e.formErrors;return r.a.createElement("div",{className:"formErrors"},Object.keys(t).map(function(e,a){return t[e].length>0?r.a.createElement("p",{key:a},e," ",t[e]):""}))},_=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(s.a)(t).call(this,e))).handleChange=function(e){if(e.target.files[0]){var t=e.target.files[0];a.setState(function(){return{image:t}}),a.setState({filename:t.name}),a.setState({url:"/images/"+t.name})}},a.updateInput=function(e){var t=e.target.name,n=e.target.value;a.setState(Object(T.a)({},t,n),function(){a.validateField(t,n)})},a.addToDb=function(e){e.preventDefault();var t=a.state.filename,n=f.a.storage().ref("/images/"+t).put(a.state.image);n.on("state_changed",function(e){},function(e){},function(){n.snapshot.ref.getDownloadURL().then(function(e){console.log("File available at",e)})});var r=a.state.author,o=null;a.state.authors.map(function(e){e.name==r&&(o=e.id)});var i=f.a.firestore().collection("Authors");null==o?i.add({name:a.state.author,addedBy:f.a.auth().currentUser.uid}).then(function(e){console.log("Author added",e.id),i.doc(e.id).collection("Books").add({title:a.state.title,genre:a.state.genre,paperback:a.state.paperback,publisher:a.state.publisher,language:a.state.language,coverUrl:a.state.url,favedBy:[]}).then(function(e){return console.log("Book added",e.id)}).then(function(){window.location.reload()})}):i.doc(o).collection("Books").add({title:a.state.title,genre:a.state.genre,paperback:a.state.paperback,publisher:a.state.publisher,language:a.state.language,coverUrl:a.state.url,favedBy:[]}).then(function(e){return console.log("Book added",e.id)}).then(function(){window.location.reload()})},a.state={authors:[],books:[],title:"",author:"",genre:"",paperback:"",publisher:"",language:"",image:null,filename:"",url:"",formErrors:{title:"",author:"",genre:"",paperback:"",publisher:"",language:""},titleValid:!1,authorValid:!1,genreValid:!1,paperbackValid:!1,publisherValid:!1,languageValid:!1},a.handleChange=a.handleChange.bind(Object(M.a)(Object(M.a)(a))),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;f.a.firestore().settings({timestampsInSnapshots:!0});var t=f.a.firestore();t.collection("Authors").get().then(function(a){var n=[];a.forEach(function(e){return n.push(Object(z.a)({id:e.id},e.data()))}),e.setState({authors:n});var r=[];e.state.authors.forEach(function(a){return t.collection("Authors").doc(a.id).collection("Books").get().then(function(t){t.forEach(function(e){return r.push(Object(z.a)({id:e.id,authorid:a.id,author:a.name},e.data()))}),e.setState({books:r})})})}),console.log("Got Books")}},{key:"validateField",value:function(e,t){var a=this.state.formErrors,n=this.state.titleValid,r=this.state.authorValid,o=this.state.genreValid,i=this.state.paperbackValid,l=this.state.publisherValid,u=this.state.languageValid;switch(e){case"title":n=t.length>=1,a.Title=n?"":" is missing";break;case"author":r=t.length>=1,a.Author=r?"":" is missing";break;case"genre":o=t.length>=3&&!t.match("[0-9]+"),a.Genre=o?"":" is too short or contains number";break;case"paperback":i=t.match("^[0-9]+$")&&!t.match("^[0]+"),a.Paperback=i?"":" must contain number";break;case"publisher":l=t.length>=3,a.Publisher=l?"":" is too short";break;case"language":u=t.length>=2,a.Language=u?"":" is too short"}this.setState({formErrors:a,titleValid:n,authorValid:r,genreValid:o,paperbackValid:i,publisherValid:l,languageValid:u},this.validateForm)}},{key:"validateForm",value:function(){this.setState({formValid:this.state.titleValid&&this.state.authorValid&&this.state.genreValid&&this.state.paperbackValid&&this.state.publisherValid&&this.state.languageValid})}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(B,null,r.a.createElement("div",null,r.a.createElement("p",null,"Add additional books:"),r.a.createElement("form",{onSubmit:this.addToDb},r.a.createElement(L,{type:"text",name:"title",placeholder:"Title",onChange:this.updateInput,value:this.state.title}),r.a.createElement(L,{type:"text",name:"author",placeholder:"Author",onChange:this.updateInput,value:this.state.author}),r.a.createElement(L,{type:"text",name:"genre",placeholder:"Genre",onChange:this.updateInput,value:this.state.genre}),r.a.createElement(L,{type:"text",name:"paperback",placeholder:"Paperback",onChange:this.updateInput,value:this.state.paperback}),r.a.createElement(L,{type:"text",name:"publisher",placeholder:"Publisher",onChange:this.updateInput,value:this.state.publisher}),r.a.createElement(L,{type:"text",name:"language",placeholder:"Language",onChange:this.updateInput,value:this.state.language}),r.a.createElement("input",{type:"file",onChange:this.handleChange}),r.a.createElement("div",null,r.a.createElement(U,{type:"submit",disabled:!this.state.formValid},"Submit"))),r.a.createElement(N,{formErrors:this.state.formErrors})),r.a.createElement("br",null)),r.a.createElement(D,null,r.a.createElement(G,{books:this.state.books})))}}]),t}(n.Component);f.a.initializeApp({apiKey:"AIzaSyDb6MxVPz02Dzu6TBU6uRMZk6lSfsEuH8E",authDomain:"solwit-pjatk-arc-2018-gr3.firebaseapp.com",databaseURL:"https://solwit-pjatk-arc-2018-gr3.firebaseio.com/",projectId:"solwit-pjatk-arc-2018-gr3",storageBucket:"solwit-pjatk-arc-2018-gr3.appspot.com",messagingSenderId:"314895835823"});var J=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(c.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).state={isLoggedIn:!1},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.unregisterAuthObserver=f.a.auth().onAuthStateChanged(function(t){return e.setState({isLoggedIn:!!t})})}},{key:"componentWillUnmount",value:function(){this.unregisterAuthObserver()}},{key:"render",value:function(){return this.state.isLoggedIn?r.a.createElement(C,null,r.a.createElement(A,null,r.a.createElement(x,null,"Library test app for Expedition project"),r.a.createElement(F,null,"Welcome ",f.a.auth().currentUser.displayName,"! You are now logged-in!"),r.a.createElement(U,{onClick:function(){return f.a.auth().signOut()}},"Logout")),r.a.createElement(_,null)):r.a.createElement(R,null)}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(J,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[29,2,1]]]);
//# sourceMappingURL=main.34a418ac.chunk.js.map