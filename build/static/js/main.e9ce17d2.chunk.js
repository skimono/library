(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{29:function(e,t,a){e.exports=a(57)},34:function(e,t,a){},57:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(13),i=a.n(o),l=(a(34),a(3)),u=a(4),s=a(7),c=a(5),h=a(6),d=a(25),m=a.n(d),g=a(2),f=a.n(g),p=a(8),b=a(9);function v(){var e=Object(p.a)(["\n  font-family: inherit;\n  font-size: 1rem;\n  border-radius: 0;\n  padding: 0.25rem 1rem;\n  margin: 0 1rem;\n  margin-bottom: 0.3rem;\n  background: #777;\n  color: white;\n  border: 2px solid;\n"]);return v=function(){return e},e}function E(){var e=Object(p.a)(["\n  font-family: inherit;\n  font-size: 1rem;\n  border-radius: 0;\n  padding: 0.25rem 1rem;\n  margin: 0 1rem;\n  background: transparent;\n  color: white\n  border: 2px solid;\n"]);return E=function(){return e},e}function k(){var e=Object(p.a)(["\n  color: white;\n"]);return k=function(){return e},e}function j(){var e=Object(p.a)(["\n  font-size: 1.3em;\n"]);return j=function(){return e},e}function O(){var e=Object(p.a)(["\n  background-color: #555;\n"]);return O=function(){return e},e}function y(){var e=Object(p.a)(["\n  padding: 30px;\n  background-color: #333;\n"]);return y=function(){return e},e}function V(){var e=Object(p.a)(["\n  background-color: #222;\n"]);return V=function(){return e},e}function w(){var e=Object(p.a)(["\n  padding: 20px;\n  color: white;\n"]);return w=function(){return e},e}function C(){var e=Object(p.a)(["\n  text-align: center;\n"]);return C=function(){return e},e}var I=b.a.div(C()),A=b.a.div(w()),S=Object(b.a)(A)(V()),D=Object(b.a)(A)(y()),B=Object(b.a)(A)(O()),x=b.a.h1(j()),U=b.a.p(k()),F=b.a.button(E()),L=b.a.input(v()),P={signInFlow:"popup",signInOptions:[f.a.auth.GoogleAuthProvider.PROVIDER_ID,f.a.auth.FacebookAuthProvider.PROVIDER_ID,f.a.auth.EmailAuthProvider.PROVIDER_ID],callbacks:{signInSuccessWithAuthResult:function(){return!1}}},R=function(e){function t(){return Object(l.a)(this,t),Object(s.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement(I,null,r.a.createElement(S,null,r.a.createElement(x,null,"Library test app for Expedition project"),r.a.createElement(U,null,"Please Log-in:"),r.a.createElement(m.a,{uiConfig:P,firebaseAuth:f.a.auth()})))}}]),t}(n.Component),T=a(19),z=a(14),M=a(10),_=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(s.a)(this,Object(c.a)(t).call(this,e))).onClickSetFav=function(){var e=a.state.fav,t=f.a.firestore().collection("Authors").doc(a.props.books.authorid).collection("Books").doc(a.props.books.id);a.state.fav?t.update({favedBy:f.a.firestore.FieldValue.arrayRemove(f.a.auth().currentUser.uid)}).then(function(){return console.log("Book unfaved")}):t.update({favedBy:f.a.firestore.FieldValue.arrayUnion(f.a.auth().currentUser.uid)}).then(function(){return console.log("Book faved")}),e=!e,a.setState({fav:e})},a.state={fav:!1},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.state.fav;this.props.books.favedBy.includes(f.a.auth().currentUser.uid)&&(e=!e,this.setState({fav:e}))}},{key:"render",value:function(){var e=this.props.books;return r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("img",{src:e.coverUrl,alt:e.title+" cover",height:"300",width:"225"})),r.a.createElement("td",null,e.title),r.a.createElement("td",null,e.author),r.a.createElement("td",null,e.genre),r.a.createElement("td",null,e.pages),r.a.createElement("td",null,e.publisher),r.a.createElement("td",null,e.language),r.a.createElement("td",null,r.a.createElement("button",{onClick:this.onClickSetFav},this.state.fav?r.a.createElement("i",{className:"fas fa-heart"}):r.a.createElement("i",{className:"far fa-heart"})))))}}]),t}(n.Component),G=function(e){function t(){return Object(l.a)(this,t),Object(s.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.books;return r.a.createElement("div",null,r.a.createElement("p",null,"List of known books:"),r.a.createElement("table",{align:"center"},r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Cover"),r.a.createElement("th",null,"Title"),r.a.createElement("th",null,"Author"),r.a.createElement("th",null,"Genre"),r.a.createElement("th",null,"Pages"),r.a.createElement("th",null,"Publisher"),r.a.createElement("th",null,"Language"),r.a.createElement("th",null,"Favorite")),e.map(function(e){return r.a.createElement(_,{key:e.id,books:e})}))))}}]),t}(n.Component),W=function(e){var t=e.formErrors;return r.a.createElement("div",{className:"formErrors"},Object.keys(t).map(function(e,a){return t[e].length>0?r.a.createElement("p",{key:a},e," ",t[e]):""}))},N=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(s.a)(this,Object(c.a)(t).call(this,e))).handleChange=function(e){if(e.target.files[0]){var t=e.target.files[0];a.setState(function(){return{image:t}});var n=new Date,r=n.getDate()+"-"+(n.getMonth()+1)+"-"+n.getFullYear()+"_"+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()+"_"+f.a.auth().currentUser.uid,o=a.state.filename.split(".").pop();a.setState({filename:r+o}),console.log(a.state.filename)}},a.updateInput=function(e){var t=e.target.name,n=e.target.value;a.setState(Object(z.a)({},t,n),function(){a.validateField(t,n)})},a.addToDb=function(e){e.preventDefault();var t=null,n=a.state.filename,r=f.a.storage().ref("/images/"+n).put(a.state.image);r.on("state_changed",function(e){},function(e){},function(){r.snapshot.ref.getDownloadURL().then(function(e){t=e,console.log("Cover Added",t)})});var o=a.state.author,i=null;a.state.authors.map(function(e){e.name==o&&(i=e.id,console.log("author id from flag",i))}),setTimeout(function(){var e=f.a.firestore().collection("Authors");null==i?e.add({name:a.state.author,addedBy:f.a.auth().currentUser.uid}).then(function(n){a.addBook(e,n.id,t)}):a.addBook(e,i,t)},3e3)},a.state={authorid:" ",bookid:" ",authors:[],books:[],title:"",author:"",genre:"",pages:"",publisher:"",language:"",image:null,filename:"",formErrors:{title:"",author:"",genre:"",pages:"",publisher:"",language:""},titleValid:!1,authorValid:!1,genreValid:!1,pagesValid:!1,publisherValid:!1,languageValid:!1},a.addToDb=a.addToDb.bind(Object(M.a)(Object(M.a)(a))),a.handleChange=a.handleChange.bind(Object(M.a)(Object(M.a)(a))),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;f.a.firestore().settings({timestampsInSnapshots:!0});var t=f.a.firestore();t.collection("Authors").onSnapshot(function(a){var n=[];a.forEach(function(e){return n.push(Object(T.a)({id:e.id},e.data()))}),e.setState({authors:n});var r=[];e.state.authors.forEach(function(a){return t.collection("Authors").doc(a.id).collection("Books").get().then(function(t){t.forEach(function(e){return r.push(Object(T.a)({id:e.id,authorid:a.id,author:a.name},e.data()))}),e.setState({books:r})})})}),console.log("Got Books")}},{key:"addBook",value:function(e,t,a){console.log("Author added",t),e.doc(t).collection("Books").add({title:this.state.title,genre:this.state.genre,pages:this.state.pages,publisher:this.state.publisher,language:this.state.language,coverUrl:a,favedBy:[]}).then(function(e){return console.log("Book added",e.id)}).then(function(){window.location.reload()})}},{key:"addImage",value:function(e){var t=f.a.firestore().collection("Authors").doc(this.state.authorid).collection("Books").doc(this.state.bookid),a=this.state.filename,n=f.a.storage().ref("/images/"+a).put(this.state.image);n.on("state_changed",function(e){},function(e){},function(){n.snapshot.ref.getDownloadURL().then(function(a){e=a,t.update({coverUrl:e}).then(function(){return console.log("Cover Added",e)})})})}},{key:"validateField",value:function(e,t){var a=this.state.formErrors,n=this.state.titleValid,r=this.state.authorValid,o=this.state.genreValid,i=this.state.pagesValid,l=this.state.publisherValid,u=this.state.languageValid;switch(e){case"title":n=t.length>=1,a.Title=n?"":" is missing";break;case"author":r=t.length>=1,a.Author=r?"":" is missing";break;case"genre":o=t.length>=3&&!t.match("[0-9]+"),a.Genre=o?"":" is too short or contains number";break;case"pages":i=t.match("^[0-9]+$")&&!t.match("^[0]+"),a.Pages=i?"":" must contain number";break;case"publisher":l=t.length>=3,a.Publisher=l?"":" is too short";break;case"language":u=t.length>=2,a.Language=u?"":" is too short"}this.setState({formErrors:a,titleValid:n,authorValid:r,genreValid:o,pagesValid:i,publisherValid:l,languageValid:u},this.validateForm)}},{key:"validateForm",value:function(){this.setState({formValid:this.state.titleValid&&this.state.authorValid&&this.state.genreValid&&this.state.pagesValid&&this.state.publisherValid&&this.state.languageValid})}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(D,null,r.a.createElement("div",null,r.a.createElement("p",null,"Add additional books:"),r.a.createElement("form",{onSubmit:this.addToDb},r.a.createElement(L,{type:"text",name:"title",placeholder:"Title",onChange:this.updateInput,value:this.state.title}),r.a.createElement(L,{type:"text",name:"author",placeholder:"Author",onChange:this.updateInput,value:this.state.author}),r.a.createElement(L,{type:"text",name:"genre",placeholder:"Genre",onChange:this.updateInput,value:this.state.genre}),r.a.createElement(L,{type:"text",name:"pages",placeholder:"Pages",onChange:this.updateInput,value:this.state.pages}),r.a.createElement(L,{type:"text",name:"publisher",placeholder:"Publisher",onChange:this.updateInput,value:this.state.publisher}),r.a.createElement(L,{type:"text",name:"language",placeholder:"Language",onChange:this.updateInput,value:this.state.language}),r.a.createElement("input",{type:"file",onChange:this.handleChange}),r.a.createElement("div",null,r.a.createElement(F,{type:"submit",disabled:!this.state.formValid},"Submit"))),r.a.createElement(W,{formErrors:this.state.formErrors})),r.a.createElement("br",null),r.a.createElement("br",null)),r.a.createElement(B,null,r.a.createElement(G,{books:this.state.books})))}}]),t}(n.Component);f.a.initializeApp({apiKey:"AIzaSyDb6MxVPz02Dzu6TBU6uRMZk6lSfsEuH8E",authDomain:"solwit-pjatk-arc-2018-gr3.firebaseapp.com",databaseURL:"https://solwit-pjatk-arc-2018-gr3.firebaseio.com/",projectId:"solwit-pjatk-arc-2018-gr3",storageBucket:"solwit-pjatk-arc-2018-gr3.appspot.com",messagingSenderId:"314895835823"});var H=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(s.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).state={isLoggedIn:!1},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.unregisterAuthObserver=f.a.auth().onAuthStateChanged(function(t){return e.setState({isLoggedIn:!!t})})}},{key:"componentWillUnmount",value:function(){this.unregisterAuthObserver()}},{key:"render",value:function(){return this.state.isLoggedIn?r.a.createElement(I,null,r.a.createElement(S,null,r.a.createElement(x,null,"Library test app for Expedition project"),r.a.createElement(U,null,"Welcome ",f.a.auth().currentUser.displayName,"! You are now logged-in!"),r.a.createElement(F,{onClick:function(){return f.a.auth().signOut()}},"Logout")),r.a.createElement(N,null)):r.a.createElement(R,null)}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(H,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[29,2,1]]]);
//# sourceMappingURL=main.e9ce17d2.chunk.js.map